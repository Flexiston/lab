"use strict";var main=function(){var n=document.getElementById(SIMULATOR_CANVAS_ID),E=document.getElementById(OVERLAY_DIV_ID),i=document.getElementById(UI_DIV_ID),r=document.getElementById(CAMERA_DIV_ID),S=document.getElementById(WIND_SPEED_DIV_ID),a=document.getElementById(WIND_SPEED_SPAN_ID),_=document.getElementById(CHOPPINESS_DIV_ID),o=document.getElementById("size-value");setText(_,INITIAL_CHOPPINESS,CHOPPINESS_DECIMAL_PLACES),setText(o,INITIAL_SIZE,SIZE_DECIMAL_PLACES);function s(e){var t=.5/Math.tan(FOV/2)*e;setPerspective(i,t+"px")}var d=new Camera,N=makePerspectiveMatrix(new Float32Array(16),FOV,MIN_ASPECT,NEAR,FAR),D=new Simulator(n,window.innerWidth,window.innerHeight),l=new Profile(document.getElementById(PROFILE_CANVAS_ID)),P=new Slider(r,SIZE_SLIDER_X,SIZE_SLIDER_Z,SIZE_SLIDER_LENGTH,MIN_SIZE,MAX_SIZE,INITIAL_SIZE,SIZE_SLIDER_BREADTH,SIZE_HANDLE_SIZE),A=new Slider(r,CHOPPINESS_SLIDER_X,CHOPPINESS_SLIDER_Z,CHOPPINESS_SLIDER_LENGTH,MIN_CHOPPINESS,MAX_CHOPPINESS,INITIAL_CHOPPINESS,CHOPPINESS_SLIDER_BREADTH,CHOPPINESS_HANDLE_SIZE),u=window.innerWidth,p=window.innerHeight,T=0,c=0,x=NONE,m=new Arrow(r,INITIAL_WIND[0],INITIAL_WIND[1]);setText(a,m.getValue(),WIND_SPEED_DECIMAL_PLACES),setTransform(S,"translate3d("+WIND_SPEED_X+"px, 0px, "+Math.max(MIN_WIND_SPEED_Z,m.getTipZ()+WIND_SPEED_OFFSET)+"px) rotateX(90deg)");function L(e,t,I,n,r){premultiplyMatrix(g,e,N),invertMatrix(g,g),setVector4(y,t/n*2-1,(r-I)/r*2-1,1,1),transformVectorByMatrix(y,y,g),setVector4(O,t/n*2-1,(r-I)/r*2-1,-1,1),transformVectorByMatrix(O,O,g),projectVector4(y,y),projectVector4(O,O);var E=-y[1]/(O[1]-y[1]);return[y[0]+E*(O[0]-y[0]),y[1]+E*(O[1]-y[1]),y[2]+E*(O[2]-y[2])]}var g=[],y=[],O=[];E.addEventListener("mousedown",function(e){e.preventDefault();var t=getMousePosition(e,i),I=t.x,n=t.y,r=L(d.getViewMatrix(),I,n,u,p);m.distanceToTip(r)<ARROW_TIP_RADIUS?x=ROTATING:P.distanceToHandle(r)<SIZE_HANDLE_RADIUS?x=SLIDING_SIZE:A.distanceToHandle(r)<CHOPPINESS_HANDLE_RADIUS?x=SLIDING_CHOPPINESS:(x=ORBITING,T=I,c=n)},!1),E.addEventListener("mousemove",function(e){e.preventDefault();var t=getMousePosition(e,i),I=t.x,n=t.y,r=L(d.getViewMatrix(),I,n,u,p);m.distanceToTip(r)<ARROW_TIP_RADIUS||x===ROTATING?E.style.cursor="move":P.distanceToHandle(r)<SIZE_HANDLE_RADIUS||A.distanceToHandle(r)<CHOPPINESS_HANDLE_RADIUS||x===SLIDING_SIZE||x===SLIDING_CHOPPINESS?E.style.cursor="ew-resize":x===ORBITING?(E.style.cursor="-webkit-grabbing",E.style.cursor="-moz-grabbing",E.style.cursor="grabbing"):(E.style.cursor="-webkit-grab",E.style.cursor="-moz-grab",E.style.cursor="grab"),x===ORBITING?(d.changeAzimuth((I-T)/u*SENSITIVITY),d.changeElevation((n-c)/p*SENSITIVITY),T=I,c=n):x===ROTATING?(m.update(r[0],r[2]),D.setWind(m.getValueX(),m.getValueY()),setText(a,m.getValue(),WIND_SPEED_DECIMAL_PLACES),setTransform(S,"translate3d("+WIND_SPEED_X+"px, 0px, "+Math.max(MIN_WIND_SPEED_Z,m.getTipZ()+WIND_SPEED_OFFSET)+"px) rotateX(90deg)")):x===SLIDING_SIZE?P.update(r[0],function(e){D.setSize(e),setText(o,e,SIZE_DECIMAL_PLACES)}):x===SLIDING_CHOPPINESS&&A.update(r[0],function(e){D.setChoppiness(e),setText(_,e,CHOPPINESS_DECIMAL_PLACES),l.render(e)})}),E.addEventListener("mouseup",function(e){e.preventDefault(),x=NONE}),window.addEventListener("mouseout",function(e){var t=e.relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||(x=NONE)});function e(){var e,t=window.innerWidth,I=window.innerHeight;E.style.width=t+"px",E.style.height=I+"px",p=t/I>MIN_ASPECT?(makePerspectiveMatrix(N,FOV,t/I,NEAR,FAR),D.resize(t,I),i.style.width=t+"px",i.style.height=I+"px",r.style.width=t+"px",r.style.height=I+"px",n.style.top="0px",i.style.top="0px",s(I),u=t,I):(e=t/MIN_ASPECT,makePerspectiveMatrix(N,FOV,t/e,NEAR,FAR),D.resize(t,e),n.style.top=.5*(I-e)+"px",i.style.top=.5*(I-e)+"px",s(e),i.style.width=t+"px",i.style.height=e+"px",r.style.width=t+"px",r.style.height=e+"px",u=t,e)}window.addEventListener("resize",e),e();var w=(new Date).getTime();!function e(t){var I=(t-w)/1e3||0;w=t;var n=.5/Math.tan(FOV/2)*p;setTransform(r,"translate3d(0px, 0px, "+n+"px) "+toCSSMatrix(d.getViewMatrix())+" translate3d("+u/2+"px, "+p/2+"px, 0px)"),D.render(I,N,d.getViewMatrix(),d.getPosition()),requestAnimationFrame(e)}()};hasWebGLSupportWithExtensions(["OES_texture_float","OES_texture_float_linear"])?main():(document.getElementById("error").style.display="block",document.getElementById("footer").style.display="none");